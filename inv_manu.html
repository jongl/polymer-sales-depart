<polymer-element name="sales-depart-inv-manu">
	<template>
		<link rel="stylesheet" type="text/css" href="css/inventory.css">
		<link rel="stylesheet" type="text/css" href="css/common.css">
		<core-card id="backgroundWhite" layout vertical>
			<div id="backgroundWrapper">
				<h1>Manufacturer Management</h1>
				<div id="bTb">
					<div id="bTb_left">
						<h2>Find a Manufacturer</h2>
						<input type="text"></input>
						
						<div class="button" on-click="{{onClick_search}}">Search</div>
					</div>
					<div id="bTb_right">
							<h2>Add a New Manufacturer</h2>
							<input type="text" id="manuInput"></input>
							
							<div class="button" on-click="{{onClick_add}}">Add a New Item</div>
					</div>
				</div>
				<div>
					<table>
						<tr>
							<template repeat="{{head in tableHeader_manu}}">
								<th>{{head}}</th>
							</template>
						</tr>
						<!-- template repeats the result -->
						<template repeat="{{row in trimedManuArray}}">
							<tr>
								<td><strong>{{row.manu}}</strong></td>
								<td>{{row.date}}</strong></td>
								<td><img class="editIcon" src="{{img_editIcon}}" /></td>
								<td>
									<div class="delButton" onclick='deleteElemManu("{{row.key}}", "{{row.manu}}")'></div>
								</td>
							</tr>
						</template>
					</table>
				</div>
			</div>
		</core-card>
	</template>
	
	<script type="text/javascript" src="js/common.js"></script>
	<script>
		function deleteElemManu(key, name) {
			if (confirm("Are you sure you want to delete this manufacturer? This will delete all inventory items belong to this manufacturer.")) {
				jsonData_manu.child(key).remove();
				deleteItemsByManu(name);
			}
			// 아래 폴리머를 이용해서 바로 다시 리스트를 로드해와야 할 것 같다
			// 지우는 경우 단순히 manu 뿐만 아니라 item list에서도 찾아서 지워야 할 것 같다
		}
		
		//!!!!!!!!!!!!!!! need to fix here after inventory revision
		function deleteItemsByManu(name) {
			inventoryArray.forEach( function (entry) {
				console.log(entry); // 각 entry는 manu 값이 있다
				if (entry.manu == name) 
					jsonData_inv.child(entry.model).remove();
			});
			
			// reload
		}
		
		$(document).ready(function() {
			reloadManu();
			
			// child added 됐을 때도 또한 리스트를 리로드 해주자
			
			this.addEventListener('addButtonClick', function(e) {
				var userInput = $('body /deep/ #manuInput').val();
				var tempArr = new Array();
				
				
				if (userInput.length > 0) {
					var dateStr = getDateStr();
					var key = userInput + dateStr;
					tempArr[manuContent[0][manuContentCheck_key]] = userInput;
					tempArr[manuContentKey_date] = dateStr;
					tempArr[manuContentKey_key] = key;
					
					jsonData_manu.push();
					jsonData_manu.child(key).set(tempArr);
					console.log('added');
				} else
					console.log('no input');
				// get 
				
				// check for dup key
				// and add to json
				
				// 구조가 이걸론 안되겠다...?
				// 제조사를 지우게 되면 어떻게 되는건가?
				
				
				// ***************
				// *************** add hour and min and make key date + time + manu
				// *************** make time function separately
				// ***************
				
				// *************** check for trimed array, it generates the first elem as undef
				// *************** maybe because it is a child?
				
				//checkDupKey(inventoryArray, invContent[invContentCheck_index][invContentCheck_key], modelNoCheck))
				
			});
		});
		Polymer('sales-depart-inv-manu', {
			ready: function() {
				this.img_editIcon = imgs.inv_icon_inventory;
				this.tableHeader_manu = tableHeader_manu;
				this.manuArray = manuArray;
				this.manuContent = manuContent;
				this.manuContentCheck_index = manuContentCheck_index;
				this.manuContentCheck_key = manuContentCheck_key;
				this.trimManuArray();
			},
			trimManuArray: function() {
				this.trimedManuArray = new Array();
				var key = this.manuContent[this.manuContentCheck_index][this.manuContentCheck_key];
				
				for (i = 0; i < this.manuArray.length; i++)
					if (!checkDupKey(this.trimedManuArray, key, this.manuArray[i][key]))
						this.trimedManuArray.push(this.manuArray[i]);
			},
			onClick_add: function() {
				this.fire('addButtonClick');
			}
		});
	</script>
<polymer-element>